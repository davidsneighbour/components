<?xml version="1.0" encoding="UTF-8"?>
<OpenSearchDescription xmlns="http://a9.com/-/spec/opensearch/1.1/"
                       xmlns:moz="http://www.mozilla.org/2006/browser/search/">
{{ $config := site.Data.dnb.opensearch.config }}
{{ $autoupdate := with $config.enable_autoupdate | default true }}
{{ $title := $config.title | default printf "%s" site.Title }}
{{ if gt (len $title) 16 }}
  {{ warnf "OpenSearch: parameter %s must be 16 or less characters (see %s)" "title" $config.hookLink }}
{{ end }}
{{ $description := $config.description | default printf "%s %s" "Search on" site.Title }}
{{ if gt (len $description) 1024 }}
  {{ warnf "OpenSearch: parameter %s must be 1024 or less characters (see %s)" "description" $config.hookLink }}
{{ end }}
{{ $searchUrl := "" }}
{{ with $config.query_url }}
  {{ $searchUrl = printf "%s%s" site.baseUrl . }}
{{ else }}
  {{ $searchUrl = printf "%s%s" site.baseUrl "search/?q={searchTerms}" }}
  {{ warnf "OpenSearch: using default site search URL (see %s)" $config.hookLink }}
{{ end }}
{{ $searchForm := "" }}
{{ with $config.search_form }}
  {{ $searchForm = printf "%s%s" site.baseUrl . }}
{{ else }}
  {{ $searchForm = printf "%s%s" site.baseUrl "search/" }}
  {{ warnf "OpenSearch: using default site search form URL (see %s)" $config.hookLink }}
{{ end }}
{{ $image := "" }}
{{ with $config.image }}
  {{ $image = printf "%s%s" site.baseUrl . }}
{{ else }}
  {{ $image = printf "%s%s" site.baseUrl "favicon.png" }}
  {{ warnf "OpenSearch: using default site search icon (see %s)" $config.hookLink }}
{{ end }}
  <ShortName>{{ $title }}</ShortName>
  <Description>{{ $description }}</Description>
  <Url type="text/html" method="get" template="{{ $searchUrl }}"/>
  <Image height="32" width="32" type="image/png">{{ $image }}</Image>
  <moz:SearchForm>{{ $searchForm }}</moz:SearchForm>
  <OutputEncoding>{{ $config.output_encoding | default "UTF-8" }}</OutputEncoding>
  <InputEncoding>{{ $config.input_encoding | default "UTF-8" }}</InputEncoding>
  {{ if eq true (bool $autoupdate) -}}
    <Url type="application/opensearchdescription+xml" rel="self" template="{{ site.baseUrl }}opensearch.xml" />
  {{- end }}
</OpenSearchDescription>
